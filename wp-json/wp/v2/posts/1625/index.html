{"id":1625,"date":"2023-07-11T08:47:59","date_gmt":"2023-07-11T03:17:59","guid":{"rendered":"https:\/\/specmatic.dvox.biz\/?p=1625"},"modified":"2023-07-18T16:50:52","modified_gmt":"2023-07-18T11:20:52","slug":"redis-stubbing-with-specmatic-contract-testing","status":"publish","type":"post","link":"https:\/\/specmatic.dvox.biz\/updates\/redis-stubbing-with-specmatic-contract-testing\/","title":{"rendered":"Redis Stubbing with Specmatic Contract Testing"},"content":{"rendered":"\n<figure class=\"wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio\"><div class=\"wp-block-embed__wrapper\">\n<div class=\"ast-oembed-container\" style=\"height: 100%;\"><iframe loading=\"lazy\" title=\"Redis Stubbing with Specmatic Contract Testing\" width=\"500\" height=\"281\" src=\"https:\/\/www.youtube.com\/embed\/cw-lY-BySs0?feature=oembed\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen><\/iframe><\/div>\n<\/div><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<h2 class=\"wp-block-heading\">Check out the sample code<\/h2>\n\n\n\n<p><strong>Sample files: <\/strong><a rel=\"noreferrer noopener\" href=\"https:\/\/github.com\/znsio\/specmatic-redis-sample\" target=\"_blank\">https:\/\/github.com\/znsio\/specmatic-redis-sample<\/a><br><strong>Download Specmatic:<\/strong> <a rel=\"noreferrer noopener\" href=\"https:\/\/github.com\/znsio\/specmatic\/releases\" target=\"_blank\">https:\/\/github.com\/znsio\/specmatic\/releases<\/a><\/p>\n\n\n\n<p><a href=\"https:\/\/specmatic.dvox.biz\/contact-us\/\" data-type=\"page\" data-id=\"475\">Contact us<\/a> to join the private beta.<\/p>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<h2 class=\"wp-block-heading\">Transcript<\/h2>\n\n\n\n<h3 class=\"wp-block-heading\">Overview &#8211; how Specmatic can be used to stub out Redis<\/h3>\n\n\n\n<p>A typical HTTP consumer would send an HTTP request to an API where it is received by a controller. Let&#8217;s say the controller needs to fetch some data using a service object, and let&#8217;s say the service object looks up the data in an instance of Redis. Redis responds with the data, the service object returns it to the controller, and the controller uses the data to formulate a response to the consumer. This is how it works in production. But in test mode, things might be a little different. Let&#8217;s say there&#8217;s an OpenAPI specification for the API, and we feed it to Specmatic to run contract tests against the API. <strong>Instead of using an actual instance of Redis, we&#8217;ll stub it out and have the contract test set expectations so that the Redis stub knows what data to return for any query sent to it by the application. Now, when we run the contract tests and the service object does a look up in Redis, it&#8217;s actually hitting the Redis stub. <\/strong>The Redis stub responds and the service class understands it. None the wiser that it isn&#8217;t an actual instance of Redis.<\/p>\n\n\n\n<p>The stub is wire compatible, so no changes are needed in the service class for this to work. <\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" width=\"739\" height=\"480\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/redis-stub.gif\" alt=\"\" class=\"wp-image-1627\"\/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<h3 class=\"wp-block-heading\">Specmatic Redis stub in action<\/h3>\n\n\n\n<p>Let&#8217;s take a sample API that needs Redis to function. Here&#8217;s the StoreController class using the StoreService object to look up some data. <\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" width=\"1400\" height=\"852\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/StoreController-screen.jpg\" alt=\"\" class=\"wp-image-1644\" srcset=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/StoreController-screen.jpg 1400w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/StoreController-screen-300x183.jpg 300w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/StoreController-screen-1024x623.jpg 1024w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/StoreController-screen-768x467.jpg 768w\" sizes=\"(max-width: 1400px) 100vw, 1400px\" \/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>The StoreService object, in turn, looks up Redis. We&#8217;re now going to run contract tests against this API using its API specification. The contract tests will be generated from the specification by Specmatic. The specification from which the contract tests are generated is in a central Git repository. <\/p>\n\n\n\n<p>You can learn more about how Specmatic runs contract tests in a <a href=\"https:\/\/specmatic.dvox.biz\/appearance\/contract-driven-development-deploying-your-microservices-independently-without-integration-testing\/\" target=\"_blank\" rel=\"noreferrer noopener\">previous video<\/a>. <\/p>\n\n\n\n<p>Now, let&#8217;s run the contract tests. It won&#8217;t take long. Let&#8217;s take a look at the first test. Let&#8217;s scroll down a little in the logs. We can see a test here for a GET API to fetch the description of a store with ID 1. We get this response. <\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" width=\"1400\" height=\"788\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Specmatic-Redis-response-comp-1.jpg\" alt=\"\" class=\"wp-image-1648\" srcset=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Specmatic-Redis-response-comp-1.jpg 1400w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Specmatic-Redis-response-comp-1-300x169.jpg 300w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Specmatic-Redis-response-comp-1-1024x576.jpg 1024w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Specmatic-Redis-response-comp-1-768x432.jpg 768w\" sizes=\"(max-width: 1400px) 100vw, 1400px\" \/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>This description was provided by a Redis lookup. If we scroll up a little, we can see the log from the Redis tab showing the request that it received and the response that it returned. <strong>The stub itself is wire compatible. <\/strong>So the same code that talks to an actual Redis instance will talk to Specmatic&#8217;s Redis stub. But how did the stub know to return this response? Let&#8217;s dig a little deeper. Just after starting up the stubbed Redis instance, we set expectations on it. <\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img decoding=\"async\" width=\"1400\" height=\"850\" src=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Redis-expectations-comp.jpg\" alt=\"\" class=\"wp-image-1649\" srcset=\"https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Redis-expectations-comp.jpg 1400w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Redis-expectations-comp-300x182.jpg 300w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Redis-expectations-comp-1024x622.jpg 1024w, https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/Redis-expectations-comp-768x466.jpg 768w\" sizes=\"(max-width: 1400px) 100vw, 1400px\" \/><\/figure>\n\n\n\n<div style=\"height:30px\" aria-hidden=\"true\" class=\"wp-block-spacer\"><\/div>\n\n\n\n<p>For example, when it receives a GET operation with description hyphen 1, it should return this response, and so on. In fact, we can do dependency fault injection here. The Redis stub can simulate Redis errors to test that our application responds appropriately. <strong>The Redis stub setup is self contained within the test. The stub itself starts up within a millisecond. And this is all great because this test can easily run now in CI or even just locally on the laptop.<\/strong><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Instead of using an actual instance of Redis, we&#8217;ll stub it out and have the contract test set expectations so that the Redis stub knows what data to return for any query sent to it by the application. Now, when we run the contract tests and the service object does a look up in Redis, it&#8217;s actually hitting the Redis stub.<\/p>\n","protected":false},"author":5,"featured_media":1626,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"video","meta":{"_seopress_robots_primary_cat":"","_uag_custom_page_level_css":"","site-sidebar-layout":"default","site-content-layout":"","ast-site-content-layout":"","site-content-style":"default","site-sidebar-style":"default","ast-global-header-display":"","ast-banner-title-visibility":"","ast-main-header-display":"","ast-hfb-above-header-display":"","ast-hfb-below-header-display":"","ast-hfb-mobile-header-display":"","site-post-title":"","ast-breadcrumbs-content":"","ast-featured-img":"disabled","footer-sml-layout":"","theme-transparent-header-meta":"","adv-header-id-meta":"","stick-header-meta":"","header-above-stick-meta":"","header-main-stick-meta":"","header-below-stick-meta":"","astra-migrate-meta-layouts":"","ast-page-background-enabled":"default","ast-page-background-meta":{"desktop":{"background-color":"var(--ast-global-color-4)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"tablet":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"mobile":{"background-color":"","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""}},"ast-content-background-meta":{"desktop":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"tablet":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""},"mobile":{"background-color":"var(--ast-global-color-5)","background-image":"","background-repeat":"repeat","background-position":"center center","background-size":"auto","background-attachment":"scroll","background-type":"","background-media":"","overlay-type":"","overlay-color":"","overlay-gradient":""}},"footnotes":""},"categories":[58,14],"tags":[59,60],"uagb_featured_image_src":{"full":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/SpecmaticRedis-stubbing-social.jpg",1920,1080,false],"thumbnail":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/SpecmaticRedis-stubbing-social-150x150.jpg",150,150,true],"medium":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/SpecmaticRedis-stubbing-social-300x169.jpg",300,169,true],"medium_large":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/SpecmaticRedis-stubbing-social-768x432.jpg",768,432,true],"large":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/SpecmaticRedis-stubbing-social-1024x576.jpg",1024,576,true],"1536x1536":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/SpecmaticRedis-stubbing-social-1536x864.jpg",1536,864,true],"2048x2048":["https:\/\/specmatic.dvox.biz\/wp-content\/uploads\/2023\/07\/SpecmaticRedis-stubbing-social.jpg",1920,1080,false]},"uagb_author_info":{"display_name":"Joel Rosario","author_link":"https:\/\/specmatic.dvox.biz\/author\/joel\/"},"uagb_comment_info":0,"uagb_excerpt":"Instead of using an actual instance of Redis, we'll stub it out and have the contract test set expectations so that the Redis stub knows what data to return for any query sent to it by the application. Now, when we run the contract tests and the service object does a look up in Redis,&hellip;","_links":{"self":[{"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/posts\/1625"}],"collection":[{"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/comments?post=1625"}],"version-history":[{"count":17,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/posts\/1625\/revisions"}],"predecessor-version":[{"id":1694,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/posts\/1625\/revisions\/1694"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/media\/1626"}],"wp:attachment":[{"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/media?parent=1625"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/categories?post=1625"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/specmatic.dvox.biz\/wp-json\/wp\/v2\/tags?post=1625"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}